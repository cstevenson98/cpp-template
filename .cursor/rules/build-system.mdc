---
alwaysApply: true
---
# Build System Guidelines

## CMake Requirements
- Minimum CMake version: **4.0.0**
- Always set: `cmake_minimum_required(VERSION 4.0.0)`
- Enable compile commands export: `set(CMAKE_EXPORT_COMPILE_COMMANDS ON)`

## Build Types
- **Debug**: Development builds with sanitizers enabled by default
  - AddressSanitizer (ASan) for memory errors
  - UndefinedBehaviorSanitizer (UBSan) for undefined behavior
- **Release**: Optimized production builds
- **RelWithDebInfo**: Release with debug symbols
- **MinSizeRel**: Size-optimized builds

## Compiler Configuration
Always set these in CMakeLists.txt:
```cmake
set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
```

## Tooling Integration
The project uses three CMake modules in `cmake/`:

1. **CompilerWarnings.cmake**: Strict warning configuration
   - Enabled globally with `set_project_warnings_globally()`
   - Treats warnings as errors by default
   - Supports GCC, Clang, and MSVC

2. **Sanitizers.cmake**: Runtime error detection
   - Automatically enabled for Debug builds
   - Enabled globally with `enable_sanitizers_globally()`
   - Set runtime options:
     ```bash
     export ASAN_OPTIONS=detect_leaks=1:check_initialization_order=1
     export UBSAN_OPTIONS=print_stacktrace=1:halt_on_error=1
     ```

3. **ClangTidy.cmake**: Static analysis
   - Enabled globally with `enable_clang_tidy_globally()`
   - Configuration in `.clang-tidy` file
   - Treats warnings as errors

## Third-Party Dependencies
- Use `FetchContent` for external dependencies
- Mark external libraries as `SYSTEM` to suppress their warnings:
  ```cmake
  set_target_properties(external_lib PROPERTIES 
      INTERFACE_SYSTEM_INCLUDE_DIRECTORIES 
      $<TARGET_PROPERTY:external_lib,INTERFACE_INCLUDE_DIRECTORIES>)
  ```
- Apply tooling **after** declaring external dependencies

## Build Commands
```bash
# Configure
cmake -B build -DCMAKE_BUILD_TYPE=Debug

# Build
cmake --build build

# Test
cd build && ctest --output-on-failure

# Install (optional)
cmake --install build --prefix /usr/local
```

## Tooling Control
Tooling can be disabled via CMake options:
```bash
cmake -B build -DENABLE_CLANG_TIDY=OFF
cmake -B build -DENABLE_ASAN=OFF -DENABLE_UBSAN=OFF
cmake -B build -DWARNINGS_AS_ERRORS=OFF
```
